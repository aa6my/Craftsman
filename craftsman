#!/usr/bin/env php
<?php

require 'vendor/autoload.php';
define('ROOTPATH',__DIR__.DIRECTORY_SEPARATOR);

# Copy the args 
$args = $_SERVER['argv'];

# Set empty args for the CI routing system
$_SERVER['argv'] = array();

# CI Migration Class instance
$CI = require ROOTPATH.'ci_instance.php';
$CI->load->add_package_path(ROOTPATH.'src/Module');
$CI->config->load('migration', TRUE, TRUE);
$params = $CI->config->item('migration');
$CI->load->library('migration', $params);

# Pass the actual args to Symfony
$_SERVER['argv'] = $args;

# Symfony Classes
use Symfony\Component\Console\Application;

# Craftsman Classes
use Codeigniter\Migrations\Generate as GenerateCommand;
use Codeigniter\Migrations\Run as RunCommand;
use Codeigniter\Migrations\Rollback as RollbackCommand;
use Codeigniter\Migrations\Refresh as RefreshCommand;
use Codeigniter\Migrations\Reset as ResetCommand;
use Codeigniter\Migrations\Info as MigrationInfoCommand;

# Migration Instances
$migration = array(
	new GenerateCommand(),
	new RunCommand($CI->migration),
	new RollbackCommand(),
	new ResetCommand(),
	new RefreshCommand(),
	new MigrationInfoCommand()
);
$application = new Application('Craftsman','2.0.1');

foreach ($migration as $key => $command) {
	$application->add($command);
}
$application->run();
