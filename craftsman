#!/usr/bin/env php
<?php

/**
 * CLI Codeigniter Crafstman
 *
 * @author     David Sosa Valdes <https://gitlab.com/david-sosa-valdes>
 * @license    MIT License
 * @copyright  2015 David Sosa Valdes
 * @link       https://gitlab.com/david-sosa-valdes/craftsman
 * @copyright  Copyright (c) 2015, David Sosa Valdes.
 */

define('ROOTPATH',__DIR__.DIRECTORY_SEPARATOR);
define('CRAFTSMAN_VERSION', "3.0.1");

use Symfony\Component\Console\Application;

use Codeigniter\Migrations\Generate as GenerateCommand;
use Codeigniter\Migrations\Run as RunCommand;
use Codeigniter\Migrations\Rollback as RollbackCommand;
use Codeigniter\Migrations\Refresh as RefreshCommand;
use Codeigniter\Migrations\Reset as ResetCommand;
use Codeigniter\Migrations\Info as InfoCommand;
use Codeigniter\Migrations\Version as VersionCommand;
use Codeigniter\Migrations\Latest as LatestCommand;

use Codeigniter\Cerberus\Migration as CerberusMigrationCommand;

$CI = require ROOTPATH.'src/ci_instance.php';

$CI->load->add_package_path(ROOTPATH.'src/Extend');
$CI->config->load('migration', TRUE, TRUE);

if ($params = $CI->config->item('migration')) 
{
	$CI->load->library('migration', $params);
	$commands = array(
		new GenerateCommand(),
		new RunCommand($CI->migration),
		new RollbackCommand(),
		new ResetCommand(),
		new RefreshCommand(),
		new InfoCommand(),
		new VersionCommand(),
		new LatestCommand(),
		new CerberusMigrationCommand()
	);
	$application = new Application('Craftsman', CRAFTSMAN_VERSION);
	foreach ($commands as $key => $command) {
		$application->add($command);
	}
	$application->run();
}
else
{
	header('HTTP/1.1 503 Service Unavailable.', TRUE, 503);
	echo "Craftsman migration settings does not appear to set correctly.\n";
}
